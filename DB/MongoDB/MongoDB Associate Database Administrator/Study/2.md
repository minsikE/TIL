# 2주차
## MongoDB CRUD Operations: Insert and Find Documents
### Lesson 1. Inserting Documents in a MongoDB Collection
- insertOne()
    - db.<collection>.insertOne()
    - db.grades.insertOne()
        - grades collection이 없으면 자동으로 만들어줌
    
    ```jsx
    	db.grades.insertOne(  {
    		student_id: 546799,
    			scores: [
    				{
    					type: "quiz",
    					score: 50,
    				},
    				{
    					type: "homework",
    					score: 70,
    				}				
    			]
    	}  )
    
    {
    	acknowledged: true,
    	insertedId: ObjectId("62f138664985719fd9fb98f6")
    }
    ```
    
- insertMany()
    - db.<collection>.insertMany([
        
        <document 1>,
        
        <document 2>,
        
        <document 3>,
        
        ])
        
    
    ```jsx
    db.grades.insertMany([
      {
        student_id: 546789,
        products: [
          {
            type: "quiz",
            score: 50,
          },
          {
            type: "homework",
            score: 70,
          },
          {
            type: "quiz",
            score: 66,
          },
          {
            type: "exam",
            score: 70,
          },
        ],
        class_id: 551,
      },
      {
        student_id: 777777,
        products: [
          {
            type: "exam",
            score: 83,
          },
          {
            type: "quiz",
            score: 59,
          },
          {
            type: "quiz",
            score: 72,
          },
          {
            type: "quiz",
            score: 67,
          },
        ],
        class_id: 550,
      },
      {
        student_id: 223344,
        products: [
          {
            type: "exam",
            score: 45,
          },
          {
            type: "homework",
            score: 39,
          },
          {
            type: "quiz",
            score: 40,
          },
          {
            type: "homework",
            score: 88,
          },
        ],
        class_id: 551,
      },
    ])
    ```
    

---

#### Quiz

1. **What methods are available in MongoDB for inserting a single document? (Select one.)**
- **A.** .insertOne()
    
    Correct! The `insertOne()` method is a valid method that's included in the MongoDB Shell to insert a single document.
    
- **B.** .inserting()
    
    Incorrect. This is not a valid method included in the MongoDB Shell. What method can you use to insert a single document?
    
- **C.** .InsertDocument()
    
    Incorrect. This is not a valid method included in the MongoDB Shell. What method can you use to insert a single document?
    
- **D.** .insertMany()
    
    Incorrect. The `insertMany()` method is used to insert multiple documents. What method can you use to insert a single document?
    
2. Select an answer choice and then click "See Results" to submit.

**What methods are available in MongoDB for inserting multiple documents? (Select one.)**

- **A.** .InsertDocument()
    
    Incorrect. The `InsertDocument()` method is not a valid MongoDB method to insert documents. What method can you use to insert a document?
    
- **B.** .inserting()
    
    Incorrect. `inserting()` is not a valid method included in the MongoDB Shell. What method can you use to insert a document?
    
- **C.** .insertOne()
    
    Incorrect. The `insertOne()` method is a valid method included in the MongoDB Shell, but it's used to insert a single document. What method can you use to insert multiple documents?
    
- **D.** .insertMany()
    
    Correct! The `insertMany()` method is a valid method that's included in the MongoDB Shell to insert multiple documents.
### Lesson 2. Finding Documents in a MongoDB Collection
- find()
    - db.<collection>.find()
    
    ```bash
    use training
    
    db.zips.find()
    
    it
    ```
    
  - 특정 문서 검색
    - $eq:
    
    ```bash
    { field: { $eq: <value> }  }
    db.zips.find({ _id: ObjectId("5c8eccc1caa187d17ca6ed16") })
    db.zips.find({ state: "AZ" })
    ```
    
    - $in
        - allows to select all documents that have a field value equal to any of the values specified in the array

    ```bash
    db.<collection>.find({
    	<field>: { $in:
    		[<value>, <value>, ...]
    })
    
    db.zips.find({ city: { $in: ["PHOENIX", "CHICAGO"] } })
    ```

---

#### Quiz

1. Select an answer choice and then click "See Results" to submit.

**What methods are available in MongoDB for finding documents? (Select one.)**

- **A.** .find()
    
    Correct! The `find()` method is a valid method that's included in the MongoDB Shell to find documents.
    
- **B.** .query()
    
    Incorrect. This is not a valid method included in the MongoDB Shell. What method can you use to find documents?
    
- **C.** .finding()
    
    Incorrect. This is not a valid method included in the MongoDB Shell. What method can you use to find documents?
    
- **D.** .search()
    
    Incorrect. This is not a valid method included in the MongoDB Shell. What method can you use to find documents?
    
2. Select an answer choice and then click "See Results" to submit.

**You are searching for data on a small area in downtown Chicago with the following zip codes:**

```
“60601”
“60602”
“60603”
“60604”
“60605”
“60606”
```

**Which of the following query documents should you use to ensure that only the documents with the specified zip codes are returned? (Select one.)**

- **A.** { zip: { $nin : [ "60601", "60602", "60603", "60604", "60605", "60606"] } }
    
    Incorrect. The `$nin` operator returns documents that do not contain the values specified in the array. Including this query would not return the specified Chicago zip codes.
    
- **B.** { zip: { $in : [ "60601", "60602", "60603", "60604", "60605", "60606"] } }
    
    Correct! The `$in` operator returns documents that contain the values specified in the array. This query will return the specified Chicago zip codes.
    
- **C.** { zip: { $eq : "60601", "60602", "60603", "60604", "60605", "60606" } }
    
    Incorrect. This syntax is inaccurate because the `$eq` operator matches documents that contain only one specified value.
    
- **D.** { zip: "60601", "60602", "60603", "60604", "60605", "60606" }
    
    Incorrect. This syntax is inaccurate because the implicit equality operator matches documents that contain only one specified value.
### Lesson 3. Finding Documents by Using Comparson Operators
#### 종류

- $gt (greater than)
- $lt (less than)
- $lte (less than or equal to)
- $gte (greater than or equal to)

#### 형식

- <field>: { <operator> : <value> }

#### 예시

```bash
db.sales.find({ "items.price": { $gt: 50 } })
```

---

#### Quiz

1. Select an answer choice and then click "See Results" to submit.

**Your company is conducting research on the customer experience and is focused on identifying unsatisfied customers. You need to find all customers with a satisfaction rating of 1 or 2.**

**Which of the following query documents would return all customers with a satisfaction rating of 1 or 2? (Select one.)**

- **A.** { "customer.satisfaction" : { $gt : 1}}
    
    Incorrect. This query would return all documents with a customer satisfaction rating greater than 1. To solve this problem, you need to select a query that returns all documents with a customer satisfaction rating less than or equal to 2.
    
- **B.** { customer.satisfaction : { $lte : 2}}
    
    Incorrect. This syntax is incorrect. Remember, to access subdocuments, you must use the syntax `“field.nestedfield”`, which includes quotation marks.
    
- **C.** { "customer.satisfaction" : { $lt : 2}}
    
    Incorrect. This query would return all documents with a customer satisfaction rating less than 2. To solve this problem, you need to select a query that returns all documents with a customer satisfaction rating less than or equal to 2.
    
- **D.** { "customer.satisfaction" : { $lte : 2}}
    
    Correct! This query will return all documents with a customer satisfaction rating of less than or equal to 2.
    
2. Select an answer choice and then click "See Results" to submit.

**Your company wants to offer a special discount for customers who are 65 or older. Your task is to find the records for these customers. Which of the following queries would return documents for all customers 65 or older? (Select all that apply.)**

- **A.** { customer.age : { $gte : 65 }}
    
    Incorrect. This syntax is incorrect. Remember, to access subdocuments, you must use the syntax `“field.nestedfield”`, which includes quotation marks.
    
- **B.** { "customer.age" : { $gt : 64 }}
    
    Correct! This query would return all documents where the customer age is greater than 64, which includes those 65 and older.
    
- **C.** { "customer.age" : { $gte : 65 }}
    
    Correct! This query would return all documents where the customer age is greater than or equal to 65.
    
- **D.** { "customer.age" : { $lte : 65 }}
    
    Incorrect. This query would return all documents where the customer age is less than or equal to 65. To solve this problem, you need to find all documents where the customer age is 65 or older.
### Lesson 4. Querying on Arrays Element in MongoDB
#### $elemMatch

```jsx
// format
{ <field>: { $elemMatch:
	{
		<query1>,
		<query2>,
		...
	}
}}

// Find Document with an Array that contains a specified value
db.accounts.find({ products: "InvestmentFund"})

db.account.find({
	products: {
		$elemMatch: { $eq: "InvestmentStock" } // $eq: 생략가능
	}
})

db.sales.find({
	items: {
		$elemMatch: { name: "laptop", price: { $gt: 800 }, quantity: { $gte: 1 } },
	},
})
```

---

#### Quiz

1. Select one answer choice and then click "See Results" to submit. (Select one.)

**Which of the following operators can be used to find a subdocument that matches specific criteria in an array?**

- **A.** &element
    
    Incorrect. This is not a valid operator included in the MongoDB Shell. What operator can you use to find a subdocument that matches specific criteria in an array?
    
- **B.** $elemMatch
    
    Correct! The `$elemMatch` operator is a valid operator that's included in the MongoDB Shell to find a subdocument that matches specific criteria in an array.
    
- **C.** $subMatch
    
    Incorrect. This is not a valid operator included in the MongoDB Shell. What operator can you use to find a subdocument that matches specific criteria in an array?
    
- **D.** $docMatch
    
    Incorrect. This is not a valid operator included in the MongoDB Shell. What operator can you use to find a subdocument that matches specific criteria in an array?
    
2. Select one or more answer choices and then click "See Results" to submit.

**What will the following query return? (Select one.)**

```scss
db.books.find({ genre: "Historical" })
```

- **A.** All documents where the genre field is equal to either the scalar value of “Historical” or an array that contains “Historical”.
    
    Correct! This query will return all documents that contain “Historical” as a scalar value and as an array element within the genre field.
    
- **B.** All documents that contain the string “Historical” across any field.
    
    Incorrect. This query will not return all documents that contain the string “Historical” in any field. It will return all documents that contain “Historical” as a scalar value and as an array element within the genre field.
    
- **C.** All documents where the genre field does not contain the value “Historical”.
    
    Incorrect. This query will not filter out all documents that contain the string “Historical” in any field. It will return all documents that contain “Historical” as a scalar value and as an array element within the genre field.
### Lesson 5. Finding Documents by Using Logical Operators
- $and
    
    ```bash
    db.<collection>.find({
    	$and: [
    		{<expression>},
    		{<expression>},
    		...
    	]
    })
    
    db.collection.find( { <expression>, <expression> } )
    
    db.routes.find({
    	$and: [{ "airline": "Southwest Airlines" }, { "stops": { $gte: 1 } }],
    })
    
    db.routes.find({	"airline": "Southwest Airlines", "stops": { $gte: 1 } })
    ```
    
- $or
    
    ```bash
    db.<collection>.find({
    	$or: [
    		{<expression 1>},
    		{<expression 2>},
    		...
    	]
    })
    
    db.routes.find({	$or: [{ dst_airport: "SEA" }, { src_airport: "SEA" }] })
    ```
    
    ```json
    // Use the $and operator to use multiple $or expressions in your query.
    db.routes.find({
    	$and: [
    		{ $or: [
    			{ dst_airport: "SEA" },
    			{ src_airport: "SEA" }
    		}},
    		{ $or: [
    			{ airline: "American Airlines" },
    			{ airplane: 320 }
    		]},
    	]
    })
    ```
    

---

#### Quiz

1. Select one or more answer choices and then click "See Results" to submit.

**You want to know which mobile food trucks in your neighborhood, Astoria, are the best spots to eat. Using the `inspections` collection, you’re making a map of all mobile food trucks nearby that have passed inspection. What should you include in your query document to ensure that you find all the mobile food vendors in Astoria that passed inspection? (Select one.)**

- **A.** { "sector": "Mobile Food Vendor - 881" } ,{ "address.city": "ASTORIA"} , {"result": "Pass"}
    
    Incorrect. This answer option contains three separate query documents and is invalid. In order to use implicit AND specify the values within one query document.
    
- **B.** $and: {“Mobile Food Vendor - 881”, “ASTORIA”, “Pass}
    
    Incorrect. This syntax is invalid. When using the `$and` operator, you must include each expression within an array.
    
- **C.** { "sector": "Mobile Food Vendor - 881" , "address.city": "ASTORIA" , "result": "Pass"}
    
    Correct! This query document uses implicit AND, so it will return all mobile food vendors in Astoria that have passed inspection.
    
- **D.** &and: {“Mobile Food Vendor - 881”, “ASTORIA”, “Pass}
    
    Incorrect. This syntax is invalid. When using the `$and` operator, you must include each expression within an array.
    
2. Select one or more answer choices and then click "See Results" to submit.

**What will the following query return? (Select one.)**

```jsx
db.routes.find({
  $and: [
    { $or: [{ dst_airport: "IST" }, { src_airport: "IST" }] },
    { $or: [{ stops: 0 }, { airline.name: "Turkish Airlines"}] },
  ]
})

```

- **A.** All flights departing from or landing at the Istanbul airport (IST) that are nonstop or operated by Turkish Airlines.
    
    Correct! This query will return all flights that either depart from or land at the Istanbul airport that are nonstop or operated by Turkish Airlines.
    
- **B.** All flights that are either departing from the Istanbul airport (IST) or Turkish Airlines flights that are nonstop.
    
    Incorrect. To return all flights that are either departing from the Istanbul airport or nonstop Turkish Airlines flights, you would write the following query:
    
    ```jsx
    db.routes.find({
      $or: [{ src_airport: "IST" }, { airline.name: "Turkish Airlines", stops: 0 }],
    })
    
    ```
    
- **C.** All flights that are either landing at the Istanbul airport (IST) or operated by Turkish Airlines.
    
    Incorrect. To return only flights that are landing at the Istanbul airport or those operated by Turkish Airlines, you would write the following query:
    
    ```jsx
    db.routes.find({
      $or: [{ dst_airport: "IST" }, { airline.name: "Turkish Airlines" }],
    })
    
    ```
    
- **D.** All Turkish Airlines flights that are nonstop.
    
    Incorrect. To return all Turkish Airlines flights that are nonstop, you would write the following query:
    
    ```jsx
    db.routes.find({ "airline.name": "Turkish Airlines", stops: 0 })
    ```

### Summary

In this unit, you learned how to insert and find documents in a MongoDB collection. You built queries by using the following comparison operators:

- `$gt` (greater than)
- `$lt` (less than)
- `$lte` (less than or equal to)
- `$gte` (greater than or equal to)

You also used the following logical operators:

- `$and`
- `$or`

Finally, you learned how to query elements in an array and how to use the `$elemMatch` operator.

#### Resources

Use the following resources to learn more about inserting and finding documents in MongoDB:

##### Lesson 01: Inserting Documents in a MongoDB Collection

- [MongoDB Docs: insertOne()](https://docs.mongodb.com/manual/reference/method/db.collection.insertOne/?_ga=2.261124036.810066485.1665291537-836515500.1666025886)
- [MongoDB Docs: insertMany()](https://docs.mongodb.com/manual/reference/method/db.collection.insertMany/?_ga=2.86565841.810066485.1665291537-836515500.1666025886)

##### Lesson 02: Finding Documents in a MongoDB Collection

- [MongoDB Docs: find()](https://docs.mongodb.com/manual/reference/method/db.collection.find/?_ga=2.86565841.810066485.1665291537-836515500.1666025886)
- [MongoDB Docs: $in](https://docs.mongodb.com/manual/reference/operator/query/in/?_ga=2.86565841.810066485.1665291537-836515500.1666025886)

##### Lesson 03: Finding Documents by Using Comparison Operators

- [MongoDB Docs: Comparison Operators](https://docs.mongodb.com/manual/reference/operator/query-comparison/?_ga=2.86565841.810066485.1665291537-836515500.1666025886)

##### Lesson 04: Querying on Array Elements in MongoDB

- [MongoDB Docs: $elemMatch](https://docs.mongodb.com/manual/reference/operator/query/elemMatch/?_ga=2.86565841.810066485.1665291537-836515500.1666025886)
- [MongoDB Docs: Querying Arrays](https://docs.mongodb.com/manual/tutorial/query-array-of-documents/?_ga=2.86565841.810066485.1665291537-836515500.1666025886#combination-of-elements-satisfies-the-criteria)

##### Lesson 05: Finding Documents by Using Logical Operators

- [MongoDB Docs: Logical Operators](https://docs.mongodb.com/manual/reference/operator/query-logical/?_ga=2.86565841.810066485.1665291537-836515500.1666025886)

## MongoDB CRUD Operations: Replace and Delete Documents
### Lesson 1. Replacing a Document in MongoDB
- replaceOne()
    - db.collection.replaceOne(filter, replacement, options)
        - `filter`: A query that matches the document to replace.
        - `replacement`: The new document to replace the old one with.
        - `options`: An object that specifies options for the update.
        
        ```bash
        db.books.replaceOne(
          {
            _id: ObjectId("6282afeb441a74a98dbbec4e"),
          },
          {
            title: "Data Science Fundamentals for Python and MongoDB",
            isbn: "1484235967",
            publishedDate: new Date("2018-5-10"),
            thumbnailUrl:
              "https://m.media-amazon.com/images/I/71opmUBc2wL._AC_UY218_.jpg",
            authors: ["David Paper"],
            categories: ["Data Science"],
          }
        )
        ```
        

---

#### Quiz

1. **Which of the following statements regarding the `replaceOne()` method for the MongoDB Shell (`mongosh`) are true? (Select all that apply.)**
- **A.** This method is used to replace a single document that matches the filter document.
    
    Correct! The `replaceOne()` method is used to replace a single document that matches the filter document.
    
- **B.** This method accepts a filter document, a replacement document, and an optional options document.
    
    Correct! The `replaceOne()` method accepts a filter document, a replacement document, and an optional options document.
    
- **C.** This method can replace multiple documents in a collection.
    
    Incorrect. The `replaceOne()` method is used to replace a single document that matches the filter document. Which of the other statements describe `replaceOne()`?
    
- **D.** This method returns a document containing an acknowledgement of the operation, a matched count, modified count, and an upserted ID (if applicable).
    
    Correct! The `replaceOne()` method returns a document containing an acknowledgement of the operation, a matched count, modified count, and an upserted ID (if applicable).
    

2. **You want to replace the following document from the `birds` collection with a new document that contains additional information on recent sightings, the scientific name of each species, and wingspan. What field should you use in the filter document to ensure that this specific document is replaced? (Select one.)**

```scss
{ _id: ObjectId("6286809e2f3fa87b7d86dccd") },
  {
    common_name: "Morning Dove",
    habitat: ["urban areas", "farms", "grassland"],
    diet: ["seeds"]
  }
```

- **A.** { _id: ObjectId("6286809e2f3fa87b7d86dccd") }
    
    Correct! Including the `_id` field as the filter document ensures that you’ll replace this specific document by using `replaceOne()`.
    
- **B.** { diet: ["seeds"] }
    
    Incorrect. `{ diet: ["seeds"] }` is not a unique field, so you cannot ensure that you will replace this specific document. If you use the `diet` field as the filter, MongoDB will replace the first document that contains `{ diet: ["seeds"] }`.
    
- **C.** { habitat: ["urban areas"] }
    
    Incorrect. `{ habitat: ["urban areas"] }` is not a unique field, so you cannot ensure that you will replace this specific document. If you use the `diet` field as the filter, MongoDB will replace the first document that contains `{ habitat: ["urban areas"] }`.
    
- **D.** { scientific_name: "Zenaida macroura" }
    
    Incorrect. The document that you want to replace does not contain `{ scientific_name: "Zenaida macroura" }`. Using `{ scientific_name: "Zenaida macroura" }` as the filter will replace another document.

### Lesson 2: Updating MongoDB Documents by Using updateOne()
```bash
db.collection.updateOne(
	<filter>,
	<update>,
	{options}
)

```

 

#### `$set`

- Adds new fields and values to a document.
- replaces the value of a field with the specified value.

```scss
db.podcasts.updateOne(
  {
    _id: ObjectId("5e8f8f8f8f8f8f8f8f8f8f8"),
  },

  {
    $set: {
      subscribers: 98562,
    },
  }
)
```

#### `upsert`

- creates a new document if no documents match the filtered criteria.

```jsx
db.podcasts.updateOne(
  { title: "The Developer Hub" },
  { $set: { topics: ["databases", "MongoDB"] } },
  { upsert: true }
)
```

#### `$push`

- Appends a value to an array
- If absent, $push adds the array field with the value as its element

```scss
// adds a new value to the hosts array field.
db.podcasts.updateOne(
  { _id: ObjectId("5e8f8f8f8f8f8f8f8f8f8f8") },
  { $push: { hosts: "Nic Raboy" } }
)
```

---

#### Quiz

1. **You want to add an element to the `items` array field in the sales collection. To do this, what should you include in the update document? (Select one.)**

A.

```scss
 { $set: { items:[{ “name”: "tablet", “price”: 200}] } }
```

B.

```scss
 { $update: { items:[{ “name”: "tablet", “price”: 200}] } }
```

C.

```scss
 { $push: { items:[{ “name”: "tablet", “price”: 200}] } }
```

D.

```scss
 { $upsert: { items:[{ “name”: "tablet", “price”: 200}] } }
```

- **A.** Option A
    
    Incorrect. The `$set` operator replaces the value of a field with the specified value. This code example would replace the value of the `items` field. It would not add an element to the existing array.
    
- **B.** Option B
    
    Incorrect. This syntax is invalid. `$update` is not a MongoDB operator.
    
- **C.** Option C
    
    Correct! The `$push` operator adds an element to an array field. In this example, you will add an array element for a tablet.
    
- **D.** Option D
    
    Incorrect. This syntax is invalid. The `upsert` option can add a document to a collection if it does not already exist. `upsert` cannot be used to update the value of a field.
    

2. **Air France has recently passed inspection. In the following document, you need to update the `results` field from Fail to Pass. To do this, what should you include in your update document? (Select one.)**

```scss
{
  _id: ObjectId("56d61033a378eccde8a837f9"),
  id: '31041-2015-ENFO',
  certificate_number: 3045325,
  business_name: 'AIR FRANCE',
  date: 'Jun  9 2015',
  result: 'Fail',
  sector: 'Travel Agency - 440',
  address: {
    city: 'JAMAICA',
    zip: 11430,
    street: 'JFK INTL AIRPORT BLVD',
    number: 1
  }
}
```

A.

```scss
 { $set: {result: ‘Pass’} }
```

B.

```scss
 { $upsert: {result: ‘Pass’} }
```

C.

```scss
 { $insert: {result: ‘Pass’} }
```

D.

```scss
 { $push: {result: ‘Pass’} }
```

- **A.** Option A
    
    Correct! The `$set` operator replaces the value of a field with the specified value, so using this update document would update the `result` field to `'Pass'`.
    
- **B.** Option B
    
    Incorrect. This syntax is invalid. The `upsert` option can add a document to a collection if it does not already exist. `upsert` cannot be used as an update operator to update the value of a field.
    
- **C.** Option C
    
    Incorrect. This syntax is invalid. `$insert` is not a MongoDB update operator.
    
- **D.** Option D
    
    Incorrect. The `$push` operator adds an element to an array field. The `result` field is a string, not an array, so you cannot use the `$push` operator to update the value of `result`.